---
name: Implement hot unplug detection and recovery
status: open
created: 2025-12-24T03:41:21Z
updated: 2025-12-24T03:41:21Z
github: https://github.com/junyoulin641/CCPM/issues/27
depends_on: [19, 21]
parallel: false
conflicts_with: []
---

# Task: Implement hot unplug detection and recovery

## Description
Implement robust hot unplug detection for UART devices during active connection. When a device is physically disconnected, the system should detect this gracefully, handle the error properly, emit appropriate signals, clean up resources, and allow for reconnection without requiring an application restart. This ensures a smooth user experience when dealing with intermittent hardware connections.

## Acceptance Criteria
- [ ] SerialException caught in read_loop when device unplugged during active connection
- [ ] errorOccurred signal emitted with descriptive message ("Device disconnected")
- [ ] SerialWorker thread stops cleanly without hanging or crashing
- [ ] Port resources released properly (no lingering file handles)
- [ ] UI returns to disconnected state (Connect button re-enabled)
- [ ] Manual test: Physical unplug during active connection handled gracefully
- [ ] Manual test: Reconnection possible after hot unplug

## Technical Details
**Implementation approach:**
- In SerialWorker.read_loop():
  - Wrap serial.read() in try-except for SerialException
  - On exception, check if port is still open
  - Emit errorOccurred("Device disconnected") signal
  - Set running flag to False to exit loop cleanly
- In UARTWidget disconnect handler:
  - Ensure serial port is closed even if already disconnected
  - Clean up worker thread properly
  - Update UI to disconnected state

**Key considerations:**
- Different operating systems may raise exceptions differently (Windows vs Linux)
- Some USB-UART bridges may not immediately raise exception on unplug
- Ensure thread cleanup prevents resource leaks
- Test with both sudden unplug and graceful disconnect

**Code locations/files affected:**
- `uart_widget.py`: SerialWorker.read_loop() exception handling
- `uart_widget.py`: UARTWidget disconnect/error handlers

## Dependencies
- [ ] Task 19: Implement serial read loop complete
- [ ] Task 21: Implement disconnect logic complete

## Effort Estimate
- Size: M
- Hours: 2 hours
- Parallel: false (depends on 19, 21)

## Definition of Done
- [ ] Code implemented
- [ ] Hot unplug detected and handled without crash
- [ ] Error signal emitted correctly
- [ ] Thread cleanup verified (no zombie threads)
- [ ] Tested with physical device unplug
- [ ] Reconnection workflow works after unplug
