---
name: Implement reconnect workflow
status: open
created: 2025-12-24T03:41:21Z
updated: 2025-12-24T03:41:21Z
github: https://github.com/junyoulin641/CCPM/issues/28
depends_on: [18, 21, 27]
parallel: false
conflicts_with: []
---

# Task: Implement reconnect workflow

## Description
Ensure the complete disconnect-refresh-reconnect workflow functions correctly. After disconnecting from a UART device (either gracefully or via hot unplug), all resources should be released cleanly. The user should be able to refresh the port list and reconnect to the same or different device without restarting the application. This verifies end-to-end resource management.

## Acceptance Criteria
- [ ] After disconnect, serial port resources fully released
- [ ] Port appears in refresh list after disconnect
- [ ] Can reconnect to same port without "port in use" errors
- [ ] Can connect to different port after disconnecting from another
- [ ] Multiple connect/disconnect cycles work without degradation
- [ ] No file handle leaks after repeated cycles
- [ ] Workflow tested: disconnect → refresh ports → reconnect (same port)
- [ ] Workflow tested: disconnect → refresh ports → reconnect (different port)

## Technical Details
**Implementation approach:**
- Test sequence:
  1. Connect to port A at 115200 baud
  2. Send/receive data successfully
  3. Disconnect cleanly
  4. Verify port A appears in refreshed port list
  5. Reconnect to port A
  6. Verify send/receive works again
  7. Disconnect from port A
  8. Connect to port B
  9. Verify send/receive works
- Monitor system resources (lsof on Linux, handle count on Windows)

**Key considerations:**
- Windows may hold port handles longer than Linux
- Ensure serial.close() is always called even on exceptions
- Worker thread must fully terminate before reconnection
- Port refresh should detect previously-connected ports

**Code locations/files affected:**
- `uart_widget.py`: Connection/disconnection logic verification
- Test manually with GUI application

## Dependencies
- [ ] Task 18: Implement disconnect logic complete
- [ ] Task 21: Implement port refresh logic complete
- [ ] Task 27: Hot unplug detection implemented

## Effort Estimate
- Size: S
- Hours: 1 hour
- Parallel: false (depends on 18, 21, 27)

## Definition of Done
- [ ] Disconnect → refresh → reconnect (same port) verified
- [ ] Disconnect → refresh → reconnect (different port) verified
- [ ] Multiple connect/disconnect cycles tested (at least 10 iterations)
- [ ] No resource leaks observed
- [ ] No "port in use" errors on valid reconnects
