---
name: Implement port discovery integration
status: open
created: 2025-12-24T03:41:21Z
updated: 2025-12-24T07:56:24Z
github: https://github.com/junyoulin641/CCPM/issues/17
depends_on: [11, 13]
parallel: false
conflicts_with: []
---

# Task: Implement port discovery integration

## Description
Implement automatic serial port discovery using PySerial's list_ports module. Populate the port selection combo box with available COM/serial ports and handle refresh functionality. Support cross-platform port naming conventions (Windows COM ports, Linux/macOS /dev/ devices).

## Acceptance Criteria
- [ ] `refresh_ports()` method implemented
- [ ] Uses `serial.tools.list_ports.comports()` for discovery
- [ ] Populates port combo box with discovered ports
- [ ] Handles Windows naming (COM1, COM3, etc.)
- [ ] Handles macOS/Linux naming (/dev/ttyUSB0, /dev/cu.usbserial, etc.)
- [ ] Displays "No ports available" message if none found
- [ ] Preserves current selection if port still exists after refresh
- [ ] Refresh can be called at startup and on-demand

## Technical Details
**Implementation approach:**
- Import `serial.tools.list_ports` from PySerial
- Create `refresh_ports()` method in UARTWidget
- Call `serial.tools.list_ports.comports()` to get available ports
- Clear combo box and repopulate with port names
- Handle empty list case (no ports found)
- Optional: show port descriptions alongside port names

**Key considerations:**
- PySerial handles platform differences automatically
- Port names vary by platform:
  - Windows: COM1, COM3, COM4, etc.
  - Linux: /dev/ttyUSB0, /dev/ttyACM0, etc.
  - macOS: /dev/cu.usbserial-*, /dev/tty.usbserial-*
- Save current selection before refresh, restore if still available
- Call refresh_ports() in __init__ to populate on startup
- Optionally filter out Bluetooth ports (can be noisy on macOS)

**Code locations/files affected:**
- Modify: `uart_widget.py` (add refresh_ports method)
- Update: UARTWidget.__init__ (call refresh_ports on startup)
- Import: `import serial.tools.list_ports`

**Example implementation:**
```python
def refresh_ports(self):
    """Discover and populate available serial ports."""
    # Save current selection
    current_port = self.port_combo.currentText()

    # Clear and repopulate
    self.port_combo.clear()
    ports = serial.tools.list_ports.comports()

    if not ports:
        self.port_combo.addItem("No ports available")
        return

    for port in ports:
        # port.device is the port name (COM3, /dev/ttyUSB0, etc.)
        self.port_combo.addItem(port.device)

    # Restore selection if still available
    index = self.port_combo.findText(current_port)
    if index >= 0:
        self.port_combo.setCurrentIndex(index)
```

## Dependencies
- [ ] Task 003 completed (PySerial installed and available)
- [ ] Task 005 completed (port combo box exists)
- [ ] PySerial library installed (`pip install pyserial`)

## Effort Estimate
- Size: S
- Hours: 1.5 hours
- Parallel: false (depends on tasks 003 and 005)

## Definition of Done
- [ ] Code implemented
- [ ] Method discovers ports on all platforms (test on target OS)
- [ ] Combo box populates correctly with port names
- [ ] "No ports" case handled gracefully
- [ ] Current selection preserved across refresh when possible
- [ ] No exceptions or errors during port discovery
- [ ] Ports display in user-friendly format
