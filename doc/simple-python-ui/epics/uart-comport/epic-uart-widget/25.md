---
name: Implement optional timestamp display
status: open
created: 2025-12-24T03:41:21Z
updated: 2025-12-24T03:41:21Z
github: https://github.com/junyoulin641/CCPM/issues/25
depends_on: [14, 23]
parallel: false
conflicts_with: []
---

# Task: Implement optional timestamp display

## Description
Add a timestamp toggle checkbox and modify the message display logic to show or hide timestamps based on the checkbox state. When enabled, each message line is prepended with a formatted timestamp. This helps users correlate messages with real-world events and debug timing-sensitive protocols.

## Acceptance Criteria
- [ ] Timestamp checkbox added to control area (Task 17 checkbox)
- [ ] Timestamp display disabled by default
- [ ] When enabled, messages prepended with `[HH:MM:SS.mmm]` format
- [ ] When disabled, messages displayed without timestamp
- [ ] Timestamp reflects message buffer timestamp (not display time)
- [ ] Both RX and TX messages show timestamps when enabled
- [ ] Format is consistent and readable

## Technical Details
**Implementation approach:**
- Use the timestamp checkbox from Task 17
- Modify `display_message()` to format with timestamp:
  ```python
  def display_message(self, data: str, direction: str = 'RX'):
      # Create message entry
      message = {
          'direction': direction,
          'timestamp': datetime.now(),
          'payload': data
      }
      self.message_buffer.append(message)

      # Format for display
      if self.timestamp_checkbox.isChecked():
          timestamp_str = message['timestamp'].strftime('[%H:%M:%S.%f')[:-3] + ']'
          display_text = f"{timestamp_str} {data}"
      else:
          display_text = data

      self.rx_display.append(display_text)
  ```
- Use strftime format: `[HH:MM:SS.mmm]` (millisecond precision)
- Apply to both RX and TX messages

**Key considerations:**
- Default state: unchecked (cleaner display for most users)
- Format: 24-hour time with milliseconds for precision
- Source: use buffer timestamp (captured at message time)
- Consistency: same format for RX and TX
- Performance: minimal string formatting overhead

**Code locations/files affected:**
- `uart_widget.py` - UARTWidget.display_message() method
- `uart_widget.py` - Reference to timestamp_checkbox (from Task 17)
- `uart_widget.py` - Message buffer integration

## Dependencies
- [ ] Task 14 completed (RX text display implemented)
- [ ] Task 17 completed (timestamp checkbox added)
- [ ] Task 23 completed (message buffer with timestamps)

## Effort Estimate
- Size: S
- Hours: 1 hour
- Parallel: false (depends on tasks 14, 23)

## Definition of Done
- [ ] Code implemented
- [ ] Timestamps displayed when checkbox enabled
- [ ] Timestamps hidden when checkbox disabled
- [ ] Format is correct and readable
- [ ] Works for both RX and TX messages
- [ ] Default state is disabled
